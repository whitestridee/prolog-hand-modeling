:- module(read_files,[loadfile/2, loadpoint/3,tryloadpoint/3]).

loadfile(Lines,Filename) :-
    string_concat("points_data_with_dots/",Filename,Full),
    open(Full, read, Str),
    read_file(Str,Lines),
    close(Str).

loadpoint(Line, Filename, PointNumber) :-
    string_concat("points_data_with_dots/",Filename,Full),
    open(Full, read, Str),
    CurNumber = 0,
    read_line(PointNumber, CurNumber, Str, Line),
    close(Str).

tryloadpoint(Line, Interval, PointNumber) :-
    name_creator(Interval, PointNumber, Filename) ->
    open(Filename, read, Str),
    CurNumber = 0,
    read_line(PointNumber, CurNumber, Str, Line),
    close(Str);
    Line = [_1, _1, _1],write("File not found"), nl.


read_file(Stream, Lines) :-
    read(Stream, Line),               % Читаем строку
    (  at_end_of_stream(Stream)       % Если конец то возвращаем
    -> Lines = []                     %
    ;  Lines = [Line|NewLines],       % Иначе добавляем строку и читаем дальше...
       read_file(Stream, NewLines)
    ).

read_line(PointNumber, CurNumber, Stream, Coordinates):-
    read(Stream, Line),
     (  at_end_of_stream(Stream)       % Если конец то возвращаем
    -> Coordinates = []                     %
    ;  (CurNumber =:= PointNumber) -> Coordinates = Line;       % Иначе добавляем строку и читаем дальше...
       read_line(PointNumber, CurNumber + 1, Stream, Coordinates)
    ).
%Создаем имя файла...
name_creator(Interval, Point, FullName):-
    string_concat("points_data_with_dots/", "xyz_", Var1),
    string_concat(Var1, Interval, Var2),
    string_concat(Var2, "_", Var3),
    string_concat(Var3, Point, Var4),
    string_concat(Var4, ".txt", TryName),
    write(TryName),nl,
    exists_file(TryName) -> FullName = TryName.
